// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.26.0
// source: query.sql

package db

import (
	"context"
	"database/sql"
	"strings"
)

const addMoodleChapter = `-- name: AddMoodleChapter :exec
insert into moodle_chapter(course_id, section_idx, resource_idx, id, name, content_html) values (?, ?, ?, ?, ?, ?)
on conflict (id) do update
    set course_id = excluded.course_id,
        section_idx = excluded.section_idx,
        resource_idx = excluded.resource_idx,
        name = excluded.name,
        content_html = excluded.content_html
`

type AddMoodleChapterParams struct {
	CourseID    int64
	SectionIdx  int64
	ResourceIdx int64
	ID          int64
	Name        string
	ContentHtml string
}

func (q *Queries) AddMoodleChapter(ctx context.Context, arg AddMoodleChapterParams) error {
	_, err := q.db.ExecContext(ctx, addMoodleChapter,
		arg.CourseID,
		arg.SectionIdx,
		arg.ResourceIdx,
		arg.ID,
		arg.Name,
		arg.ContentHtml,
	)
	return err
}

const addMoodleCourse = `-- name: AddMoodleCourse :exec
insert into moodle_course(id, name) values (?, ?)
on conflict (id) do update
    set name = excluded.name
`

type AddMoodleCourseParams struct {
	ID   int64
	Name string
}

func (q *Queries) AddMoodleCourse(ctx context.Context, arg AddMoodleCourseParams) error {
	_, err := q.db.ExecContext(ctx, addMoodleCourse, arg.ID, arg.Name)
	return err
}

const addMoodleResource = `-- name: AddMoodleResource :exec
insert into moodle_resource(course_id, section_idx, idx, id, type, url, display_content) values (?, ?, ?, ?, ?, ?, ?)
on conflict (course_id, section_idx, idx) do update
    set type = excluded.type,
        url = excluded.url,
        display_content = excluded.display_content
`

type AddMoodleResourceParams struct {
	CourseID       int64
	SectionIdx     int64
	Idx            int64
	ID             sql.NullInt64
	Type           int64
	Url            string
	DisplayContent string
}

func (q *Queries) AddMoodleResource(ctx context.Context, arg AddMoodleResourceParams) error {
	_, err := q.db.ExecContext(ctx, addMoodleResource,
		arg.CourseID,
		arg.SectionIdx,
		arg.Idx,
		arg.ID,
		arg.Type,
		arg.Url,
		arg.DisplayContent,
	)
	return err
}

const addMoodleSection = `-- name: AddMoodleSection :exec
insert into moodle_section(course_id, idx, name) values (?, ?, ?)
on conflict (course_id, idx) do update
    set name = excluded.name
`

type AddMoodleSectionParams struct {
	CourseID int64
	Idx      int64
	Name     string
}

func (q *Queries) AddMoodleSection(ctx context.Context, arg AddMoodleSectionParams) error {
	_, err := q.db.ExecContext(ctx, addMoodleSection, arg.CourseID, arg.Idx, arg.Name)
	return err
}

const addMoodleUserCourse = `-- name: AddMoodleUserCourse :exec
insert into moodle_user_course(account_id, course_id) values (?, ?)
on conflict do nothing
`

type AddMoodleUserCourseParams struct {
	AccountID int64
	CourseID  int64
}

func (q *Queries) AddMoodleUserCourse(ctx context.Context, arg AddMoodleUserCourseParams) error {
	_, err := q.db.ExecContext(ctx, addMoodleUserCourse, arg.AccountID, arg.CourseID)
	return err
}

const createMoodleToken = `-- name: CreateMoodleToken :exec
insert into token(token, moodle_account_id) values (?, ?)
`

type CreateMoodleTokenParams struct {
	Token           string
	MoodleAccountID sql.NullInt64
}

func (q *Queries) CreateMoodleToken(ctx context.Context, arg CreateMoodleTokenParams) error {
	_, err := q.db.ExecContext(ctx, createMoodleToken, arg.Token, arg.MoodleAccountID)
	return err
}

const createPSToken = `-- name: CreatePSToken :exec
insert into token(token, powerschool_account_id) values (?, ?)
`

type CreatePSTokenParams struct {
	Token                string
	PowerschoolAccountID sql.NullInt64
}

func (q *Queries) CreatePSToken(ctx context.Context, arg CreatePSTokenParams) error {
	_, err := q.db.ExecContext(ctx, createPSToken, arg.Token, arg.PowerschoolAccountID)
	return err
}

const deleteAllMoodleChapters = `-- name: DeleteAllMoodleChapters :exec
delete from moodle_chapter
`

func (q *Queries) DeleteAllMoodleChapters(ctx context.Context) error {
	_, err := q.db.ExecContext(ctx, deleteAllMoodleChapters)
	return err
}

const deleteAllMoodleCourses = `-- name: DeleteAllMoodleCourses :exec

delete from moodle_course
`

// *** MOODLE SPECIFIC ***
func (q *Queries) DeleteAllMoodleCourses(ctx context.Context) error {
	_, err := q.db.ExecContext(ctx, deleteAllMoodleCourses)
	return err
}

const deleteAllMoodleResources = `-- name: DeleteAllMoodleResources :exec
delete from moodle_resource
`

func (q *Queries) DeleteAllMoodleResources(ctx context.Context) error {
	_, err := q.db.ExecContext(ctx, deleteAllMoodleResources)
	return err
}

const deleteAllMoodleSections = `-- name: DeleteAllMoodleSections :exec
delete from moodle_section
`

func (q *Queries) DeleteAllMoodleSections(ctx context.Context) error {
	_, err := q.db.ExecContext(ctx, deleteAllMoodleSections)
	return err
}

const getAllMoodleAccounts = `-- name: GetAllMoodleAccounts :many
select id, username, password from moodle_account
`

func (q *Queries) GetAllMoodleAccounts(ctx context.Context) ([]MoodleAccount, error) {
	rows, err := q.db.QueryContext(ctx, getAllMoodleAccounts)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []MoodleAccount
	for rows.Next() {
		var i MoodleAccount
		if err := rows.Scan(&i.ID, &i.Username, &i.Password); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const getAllMoodleCourses = `-- name: GetAllMoodleCourses :many
select id, name from moodle_course
`

func (q *Queries) GetAllMoodleCourses(ctx context.Context) ([]MoodleCourse, error) {
	rows, err := q.db.QueryContext(ctx, getAllMoodleCourses)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []MoodleCourse
	for rows.Next() {
		var i MoodleCourse
		if err := rows.Scan(&i.ID, &i.Name); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const getAllPSAccounts = `-- name: GetAllPSAccounts :many
select id, email, token, expires_at from powerschool_account
`

func (q *Queries) GetAllPSAccounts(ctx context.Context) ([]PowerschoolAccount, error) {
	rows, err := q.db.QueryContext(ctx, getAllPSAccounts)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []PowerschoolAccount
	for rows.Next() {
		var i PowerschoolAccount
		if err := rows.Scan(
			&i.ID,
			&i.Email,
			&i.Token,
			&i.ExpiresAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const getMoodleAccountFromId = `-- name: GetMoodleAccountFromId :one
select id, username, password from moodle_account where id = ?
`

func (q *Queries) GetMoodleAccountFromId(ctx context.Context, id int64) (MoodleAccount, error) {
	row := q.db.QueryRowContext(ctx, getMoodleAccountFromId, id)
	var i MoodleAccount
	err := row.Scan(&i.ID, &i.Username, &i.Password)
	return i, err
}

const getMoodleAccountFromToken = `-- name: GetMoodleAccountFromToken :one
select
    moodle_account.id,
    moodle_account.username
from token
inner join moodle_account
    on token.moodle_account_id = moodle_account.id
where token.token = ?
`

type GetMoodleAccountFromTokenRow struct {
	ID       int64
	Username string
}

func (q *Queries) GetMoodleAccountFromToken(ctx context.Context, token string) (GetMoodleAccountFromTokenRow, error) {
	row := q.db.QueryRowContext(ctx, getMoodleAccountFromToken, token)
	var i GetMoodleAccountFromTokenRow
	err := row.Scan(&i.ID, &i.Username)
	return i, err
}

const getMoodleChapterContent = `-- name: GetMoodleChapterContent :one
select content_html from moodle_chapter where id = ?
`

func (q *Queries) GetMoodleChapterContent(ctx context.Context, id int64) (string, error) {
	row := q.db.QueryRowContext(ctx, getMoodleChapterContent, id)
	var content_html string
	err := row.Scan(&content_html)
	return content_html, err
}

const getMoodleCourseSections = `-- name: GetMoodleCourseSections :many
select course_id, idx, name from moodle_section where course_id = ?
`

func (q *Queries) GetMoodleCourseSections(ctx context.Context, courseID int64) ([]MoodleSection, error) {
	rows, err := q.db.QueryContext(ctx, getMoodleCourseSections, courseID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []MoodleSection
	for rows.Next() {
		var i MoodleSection
		if err := rows.Scan(&i.CourseID, &i.Idx, &i.Name); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const getMoodleCourses = `-- name: GetMoodleCourses :many
select id, name from moodle_course where id in (/*SLICE:ids*/?)
`

func (q *Queries) GetMoodleCourses(ctx context.Context, ids []int64) ([]MoodleCourse, error) {
	query := getMoodleCourses
	var queryParams []interface{}
	if len(ids) > 0 {
		for _, v := range ids {
			queryParams = append(queryParams, v)
		}
		query = strings.Replace(query, "/*SLICE:ids*/?", strings.Repeat(",?", len(ids))[1:], 1)
	} else {
		query = strings.Replace(query, "/*SLICE:ids*/?", "NULL", 1)
	}
	rows, err := q.db.QueryContext(ctx, query, queryParams...)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []MoodleCourse
	for rows.Next() {
		var i MoodleCourse
		if err := rows.Scan(&i.ID, &i.Name); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const getMoodleFileResource = `-- name: GetMoodleFileResource :one
select url from moodle_resource where id = ? and type = 1
`

func (q *Queries) GetMoodleFileResource(ctx context.Context, id sql.NullInt64) (string, error) {
	row := q.db.QueryRowContext(ctx, getMoodleFileResource, id)
	var url string
	err := row.Scan(&url)
	return url, err
}

const getMoodleResourceChapters = `-- name: GetMoodleResourceChapters :many
select name, id from moodle_chapter where
    course_id = ? and
    section_idx = ? and
    resource_idx = ?
`

type GetMoodleResourceChaptersParams struct {
	CourseID    int64
	SectionIdx  int64
	ResourceIdx int64
}

type GetMoodleResourceChaptersRow struct {
	Name string
	ID   int64
}

func (q *Queries) GetMoodleResourceChapters(ctx context.Context, arg GetMoodleResourceChaptersParams) ([]GetMoodleResourceChaptersRow, error) {
	rows, err := q.db.QueryContext(ctx, getMoodleResourceChapters, arg.CourseID, arg.SectionIdx, arg.ResourceIdx)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []GetMoodleResourceChaptersRow
	for rows.Next() {
		var i GetMoodleResourceChaptersRow
		if err := rows.Scan(&i.Name, &i.ID); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const getMoodleSectionResources = `-- name: GetMoodleSectionResources :many
select course_id, section_idx, idx, id, type, url, display_content from moodle_resource where course_id = ? and section_idx = ?
`

type GetMoodleSectionResourcesParams struct {
	CourseID   int64
	SectionIdx int64
}

func (q *Queries) GetMoodleSectionResources(ctx context.Context, arg GetMoodleSectionResourcesParams) ([]MoodleResource, error) {
	rows, err := q.db.QueryContext(ctx, getMoodleSectionResources, arg.CourseID, arg.SectionIdx)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []MoodleResource
	for rows.Next() {
		var i MoodleResource
		if err := rows.Scan(
			&i.CourseID,
			&i.SectionIdx,
			&i.Idx,
			&i.ID,
			&i.Type,
			&i.Url,
			&i.DisplayContent,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const getMoodleUserCount = `-- name: GetMoodleUserCount :one
select count(*) from moodle_account
`

func (q *Queries) GetMoodleUserCount(ctx context.Context) (int64, error) {
	row := q.db.QueryRowContext(ctx, getMoodleUserCount)
	var count int64
	err := row.Scan(&count)
	return count, err
}

const getMoodleUserCourses = `-- name: GetMoodleUserCourses :many
select moodle_user_course.course_id from moodle_user_course where moodle_user_course.account_id = ?
`

func (q *Queries) GetMoodleUserCourses(ctx context.Context, accountID int64) ([]int64, error) {
	rows, err := q.db.QueryContext(ctx, getMoodleUserCourses, accountID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []int64
	for rows.Next() {
		var course_id int64
		if err := rows.Scan(&course_id); err != nil {
			return nil, err
		}
		items = append(items, course_id)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const getPSAccountFromId = `-- name: GetPSAccountFromId :one
select id, email, token, expires_at from powerschool_account where id = ?
`

func (q *Queries) GetPSAccountFromId(ctx context.Context, id int64) (PowerschoolAccount, error) {
	row := q.db.QueryRowContext(ctx, getPSAccountFromId, id)
	var i PowerschoolAccount
	err := row.Scan(
		&i.ID,
		&i.Email,
		&i.Token,
		&i.ExpiresAt,
	)
	return i, err
}

const getPSAccountFromToken = `-- name: GetPSAccountFromToken :one
select 
    powerschool_account.id,
    powerschool_account.email
from token
inner join powerschool_account
    on token.powerschool_account_id = powerschool_account.id
where token.token = ?
`

type GetPSAccountFromTokenRow struct {
	ID    int64
	Email string
}

func (q *Queries) GetPSAccountFromToken(ctx context.Context, token string) (GetPSAccountFromTokenRow, error) {
	row := q.db.QueryRowContext(ctx, getPSAccountFromToken, token)
	var i GetPSAccountFromTokenRow
	err := row.Scan(&i.ID, &i.Email)
	return i, err
}

const getPSCachedData = `-- name: GetPSCachedData :one
select data from powerschool_data_cache where account_id = ?
`

func (q *Queries) GetPSCachedData(ctx context.Context, accountID int64) ([]byte, error) {
	row := q.db.QueryRowContext(ctx, getPSCachedData, accountID)
	var data []byte
	err := row.Scan(&data)
	return data, err
}

const getPSUserCount = `-- name: GetPSUserCount :one
select count(*) from powerschool_account
`

func (q *Queries) GetPSUserCount(ctx context.Context) (int64, error) {
	row := q.db.QueryRowContext(ctx, getPSUserCount)
	var count int64
	err := row.Scan(&count)
	return count, err
}

const setMoodleAccount = `-- name: SetMoodleAccount :one

insert into moodle_account(username) values (?)
on conflict do update set username = excluded.username
returning id
`

// *** GENERIC ***
// technically this is a useless update, but on "conflict do nothing" will not
// return anything when a conflict is encountered so on "conflict do update" is
// needed to have the updated/inserted row's id returned
func (q *Queries) SetMoodleAccount(ctx context.Context, username string) (int64, error) {
	row := q.db.QueryRowContext(ctx, setMoodleAccount, username)
	var id int64
	err := row.Scan(&id)
	return id, err
}

const setPSAccount = `-- name: SetPSAccount :one
insert into powerschool_account(email) values (?)
on conflict do update set email = excluded.email
returning id
`

func (q *Queries) SetPSAccount(ctx context.Context, email string) (int64, error) {
	row := q.db.QueryRowContext(ctx, setPSAccount, email)
	var id int64
	err := row.Scan(&id)
	return id, err
}

const setPSCachedData = `-- name: SetPSCachedData :exec

insert into powerschool_data_cache(account_id, data) values (?, ?)
on conflict do update set
    data = excluded.data
`

type SetPSCachedDataParams struct {
	AccountID int64
	Data      []byte
}

// *** POWERSCHOOL SPECIFIC ***
func (q *Queries) SetPSCachedData(ctx context.Context, arg SetPSCachedDataParams) error {
	_, err := q.db.ExecContext(ctx, setPSCachedData, arg.AccountID, arg.Data)
	return err
}
